<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="sidepanel.css" />
  </head>
  <body>
    <header class="header">
      <h1>WebTap</h1>
      <button id="themeToggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme"></button>
    </header>

    <div id="errorBanner" class="error-banner">
      <div class="error-banner-header">
        <div class="error-banner-message" id="errorMessage"></div>
        <button
          class="close-btn close-btn--error"
          id="dismissError"
          title="Dismiss error"
          aria-label="Dismiss error"
        ></button>
      </div>
    </div>

    <!-- Tab Bar -->
    <nav class="tab-bar" role="tablist">
      <button class="tab-button active" data-tab="intercept" role="tab" aria-selected="true">Intercept</button>
      <button class="tab-button" data-tab="network" role="tab" aria-selected="false">Network</button>
    </nav>

    <!-- Tab 1: Intercept & Selection -->
    <main class="tab-content active" data-tab="intercept" role="tabpanel">
      <section class="section">
        <select id="pageList" size="15" aria-label="Available pages">
          <option disabled>Loading pages...</option>
        </select>

        <div class="button-row">
          <button id="reloadPages">Reload Pages</button>
        </div>

        <div class="button-row">
          <button id="connect">Connect</button>
          <button id="disconnect">Disconnect</button>
        </div>

        <div id="status" class="status-box">Not connected</div>
      </section>

      <div class="divider"></div>

      <section class="section">
        <div class="fetch-row">
          <span class="fetch-status">Intercept: <span id="fetchStatus">OFF</span></span>
          <button id="fetchToggle" class="toggle">Toggle</button>
        </div>

        <div class="response-stage-option">
          <label>
            <input type="checkbox" id="responseStage" />
            Also pause at Response stage
          </label>
        </div>

        <div class="button-row">
          <button id="clear" class="full-width">Clear Events</button>
        </div>
      </section>

      <div class="divider"></div>

      <section class="section selection-section">
        <h2 class="section-title">Element Selection</h2>

        <button id="startSelection" class="full-width">Start Selection Mode</button>

        <div id="selectionStatus" class="hidden">
          <div class="selection-header">
            <span>Selected: <strong id="selectionCount">0</strong> elements</span>
            <button id="clearSelections">Clear</button>
          </div>

          <div id="selectionList" class="selection-list"></div>

          <div class="help-text">
            Use <code>@webtap:webtap://selections</code> in Claude Code prompts to
            analyze selected elements. Reference elements as #1, #2, etc.
          </div>
        </div>
      </section>
    </main>

    <!-- Tab 2: Network & Filters -->
    <main class="tab-content" data-tab="network" role="tabpanel">
      <section class="section filter-section">
        <div class="section-header">
          <h2 class="section-title">Filters</h2>
          <span id="filterStats" class="section-meta">Loading...</span>
        </div>
        <div id="filterList" class="filter-list"></div>
        <div class="button-row filter-buttons">
          <button id="enableAllFilters">Enable All</button>
          <button id="disableAllFilters">Disable All</button>
        </div>
      </section>

      <div class="divider"></div>

      <section class="network-section">
        <div class="section-header">
          <h2 class="section-title">Network Requests</h2>
          <span id="networkCount" class="section-meta">0 requests</span>
        </div>

        <div id="networkTable" class="network-table"></div>

        <div id="requestDetails" class="request-details hidden"></div>
      </section>
    </main>

    <script src="sidepanel.js"></script>
  </body>
</html>
